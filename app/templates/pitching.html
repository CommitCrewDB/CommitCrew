{% extends "layout.html" %}

{% block title %}
Pitching{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='pitching.css') }}">

<div class="container">
    <h1 class="page-header">Pitching Table</h1>

    <div class="button-group">
        <button class="info-btn" onclick="toggleDescription()">What is Pitching?</button>
        <a class="btn add-data-btn" href="{{ url_for('add_pitching_data') }}">I want to add data</a>
    </div>

    <div id="description" class="description-popup">
        <p>Pitching in baseball is the act of throwing a baseball toward home plate to start a play. The pitcher typically stands on the pitcher's mound and throws the ball to the catcher, who is positioned behind home plate.</p>
        <button class="close-btn" onclick="toggleDescription()">Close</button>
    </div>

    <!-- Display flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="alert-container">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="get" action="{{ url_for('pitching_page') }}" class="filter-form" id="filter-form">
        <label for="sort_by">Sort By:</label>
        <select name="sort_by" id="sort_by">
            <option value="" {% if sort_by == '' %}selected{% endif %}>Default</option>
            <option value="yearID" {% if sort_by == 'yearID' %}selected{% endif %}>Year</option>
            <option value="W" {% if sort_by == 'W' %}selected{% endif %}>Wins</option>
            <option value="L" {% if sort_by == 'L' %}selected{% endif %}>Losses</option>
            <option value="ERA" {% if sort_by == 'ERA' %}selected{% endif %}>ERA</option>
        </select>

        <label for="order">Order:</label>
        <select name="order" id="order">
            <option value="" {% if order == '' %}selected{% endif %}>Default</option>
            <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
            <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
        </select>

        <label for="search">Search:</label>
        <input type="text" name="search_name" id="search_name" placeholder="Name" value="{{ search_name }}">
        <input type="text" name="search_year" id="search_year" placeholder="Year" value="{{ search_year }}">
        <input type="text" name="search_league" id="search_league" placeholder="League Name" value="{{ search_league }}">

        <button type="submit" name="action" value="get_data" class="btn">Get Data</button>
    </form>

    {% if data %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Year</th>
                    <th>Team Name</th>
                    <th>League Name</th>
                    <th>Wins</th>
                    <th>Losses</th>
                    <th>ERA</th>
                    <th>Strikeouts</th>
                    <th>Walks</th>
                    <th>Innings Pitched</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                    <tr>
                        <td>{{ row['nameFirst'] }}</td>
                        <td>{{ row['nameLast'] }}</td>
                        <td>{{ row['yearID'] }}</td>
                        <td>{{ row['teamName'] }}</td>
                        <td>{{ row['leagueName'] }}</td>
                        <td>{{ row['W'] }}</td>
                        <td>{{ row['L'] }}</td>
                        <td>{{ row['ERA'] }}</td>
                        <td>{{ row['strikeouts'] }}</td>
                        <td>{{ row['walks'] }}</td>
                        <td>{{ row['inningsPitched'] }}</td>
                        <td>
                            <a class="btn update-btn" href="{{ url_for('update_pitching_data', id=row['ID']) }}">Update</a>
                            <a class="btn delete-btn" href="{{ url_for('delete_pitching_data', id=row['ID']) }}">Delete</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('pitching_page', page=page-1, sort_by=sort_by, order=order, search_name=search_name, search_year=search_year, search_league=search_league, action=action) }}" class="btn">Previous</a>
            {% endif %}
            Page {{ page }} of {{ total_pages }}
            {% if page < total_pages %}
                <a href="{{ url_for('pitching_page', page=page+1, sort_by=sort_by, order=order, search_name=search_name, search_year=search_year, search_league=search_league, action=action) }}" class="btn">Next</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
function toggleDescription() {
    const description = document.getElementById('description');
    if (description.style.display === 'block') {
        description.style.display = 'none';
    } else {
        description.style.display = 'block';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.data-table tbody tr');
    rows.forEach(row => {
        row.addEventListener('mouseover', function() {
            this.style.backgroundColor = '#f0f8ff';
        });
        row.addEventListener('mouseout', function() {
            this.style.backgroundColor = '';
        });
    });

    const filterForm = document.getElementById('filter-form');
    filterForm.addEventListener('submit', function() {
        filterForm.classList.add('submitted');
        setTimeout(() => filterForm.classList.remove('submitted'), 1000);
    });
});
</script>
{% endblock %}