{% extends "layout.html" %}
{% block title %}
Players{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='master.css') }}">
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<h1 class="title text-center my-4">Players</h1>

<div class="text-right my-3">
    <a href="{{ url_for('add_player_page') }}" class="btn btn-success">Add New Player</a>
</div>

<div class="info-container">
    <p>
        This page displays data from the <strong>Lahman Baseball Database</strong>, specifically from the 
        <strong>Master</strong> table. This table contains information about baseball players, including their
        birth details, career statistics, and other relevant information.
    </p>
    <p>
        Use the filters below to narrow down your search and explore specific players or player statistics.
        You can also sort the data by name, birth year, or other attributes.
    </p>
    <ul>
        <li><strong>Player Name:</strong> The name of the player.</li>
        <li><strong>Birth Year:</strong> The year the player was born.</li>
        <li><strong>Death Year:</strong> The year the player passed away (if applicable).</li>
        <li><strong>Country:</strong> The birth country of the player.</li>
    </ul>
</div>

<!-- Filter Form -->
<form id="filter-form" method="get" action="/master" class="filter-form">
    <div class="form-row">
        <!-- Player Name Filter -->
        <div class="form-group">
            <label for="player_name">Player Name</label>
            <input
                type="text"
                name="player_name"
                id="player_name"
                value="{{ request.args.get('player_name', '') }}"
                class="form-control"
                placeholder="Enter Player Name"
            />
        </div>

        <!-- Birth Year Filter -->
        <div class="form-group">
            <label for="birth_year">Birth Year</label>
            <input
                type="text"
                name="birth_year"
                id="birth_year"
                value="{{ request.args.get('birth_year', '') }}"
                class="form-control"
                placeholder="Enter Birth Year"
            />
        </div>

        <!-- Death Year Filter -->
        <div class="form-group">
            <label for="death_year">Death Year</label>
            <input
                type="text"
                name="death_year"
                id="death_year"
                value="{{ request.args.get('death_year', '') }}"
                class="form-control"
                placeholder="Enter Death Year"
            />
        </div>

        <!-- Sort By Filter -->
        <div class="form-group">
            <label for="sort_by">Sort By</label>
            <select name="sort_by" id="sort_by" class="form-control">
                <option value="">Select</option>
                <option value="birth_year_asc" {% if request.args.get('sort_by') == 'birth_year_asc' %}selected{% endif %}>Birth Year (Ascending)</option>
                <option value="birth_year_desc" {% if request.args.get('sort_by') == 'birth_year_desc' %}selected{% endif %}>Birth Year (Descending)</option>
                <option value="player_name_asc" {% if request.args.get('sort_by') == 'player_name_asc' %}selected{% endif %}>Player Name (A-Z)</option>
                <option value="player_name_desc" {% if request.args.get('sort_by') == 'player_name_desc' %}selected{% endif %}>Player Name (Z-A)</option>
            </select>
        </div>

        <!-- Submit and Reset Buttons -->
        <div class="form-group btn-block">
            <button type="submit" class="btn btn-primary btn-block">Filter</button>
            <button type="reset" class="btn btn-secondary btn-block">Reset</button>
            <form method="get" action="/master">
                <input type="hidden" name="action" value="view_all">
                <button type="submit" class="btn btn-primary">View All</button>
            </form>
        </div>

        {% if players %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Player ID</th>
                        <th>Name</th>
                        <th>Birth Year</th>
                        <th>Death Year</th>
                        <th>Birth City</th>
                        <th>Birth Country</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player in players %}
                    <tr>
                        <td>{{ player.ID }}</td>
                        <td>{{ player.playerID }}</td>
                        <td>{{ player.nameFirst }} {{ player.nameLast }}</td>
                        <td>{{ player.birthYear }}</td>
                        <td>{{ player.deathYear }}</td>
                        <td>{{ player.birthCity }}</td>
                        <td>{{ player.birthCountry }}</td>
                        <td>
                            <div>
                                <form method="POST" action="/master" style="display:inline;">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="player_id" value="{{ player.ID }}">
                                    <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i> Delete</button>
                                </form>     
                            </div>   
                            <div class="mt-2">
                                <a href="{{ url_for('update_player_page', player_id=player.ID) }}" class="btn btn-warning btn-sm btn-block">
                                    <i class="fas fa-edit"></i> Update
                                </a>
                            </div>                                                          
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% elif request.args.get('search') %}
            <p>No results found. Try searching for a different player name.</p>
        {% endif %}
    </div>
</form>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div>
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% endblock %}
