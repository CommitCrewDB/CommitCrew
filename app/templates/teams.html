{% extends "layout.html" %}

{% block title %}
Teams{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='teams.css') }}">
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<h1 class="title text-center my-4">Teams</h1>

<div class="text-right my-3">
    <a href="{{ url_for('add_team_page') }}" class="btn btn-success">Add New Team</a>
</div>


<!-- Filter Form -->
<form id="filter-form" method="get" action="/teams" class="filter-form">
    <div class="form-row">
        <!-- League Filter -->
        <div class="form-group">
            <label for="league">League</label>
            <select name="league" id="league" class="form-control">
                <option value="">Select League</option>
                {% for league in leagues %}
                <option value="{{ league.id }}" {% if league.id == request.args.get('league', '') %}selected{% endif %}>
                    {{ league.name }} ({{ league.id }})
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Year Filter -->
        <div class="form-group">
            <label for="year">Year</label>
            <input
                type="text"
                name="year"
                id="year"
                value="{{ request.args.get('year', '') }}"
                class="form-control"
                placeholder="Enter Year"
            />
        </div>
        <!-- Team Name Filter -->
        <div class="form-group">
            <label for="team_name">Team Name</label>
            <input
                type="text"
                name="team_name"
                id="team_name"
                value="{{ request.args.get('team_name', '') }}"
                class="form-control"
                placeholder="Enter Team Name"
            />
        </div>

        <!-- Sort By Filter -->
        <div class="form-group">
            <label for="sort_by">Sort By</label>
            <select name="sort_by" id="sort_by" class="form-control">
                <option value="">Select</option>
                <option value="wins_asc" {% if request.args.get('sort_by') == 'wins_asc' %}selected{% endif %}>Wins (Ascending)</option>
                <option value="wins_desc" {% if request.args.get('sort_by') == 'wins_desc' %}selected{% endif %}>Wins (Descending)</option>
                <option value="year_asc" {% if request.args.get('sort_by') == 'year_asc' %}selected{% endif %}>Year (Ascending)</option>
                <option value="year_desc" {% if request.args.get('sort_by') == 'year_desc' %}selected{% endif %}>Year (Descending)</option>
                <option value="team_name_asc" {% if request.args.get('sort_by') == 'team_name_asc' %}selected{% endif %}>Team Name (A-Z)</option>
                <option value="team_name_desc" {% if request.args.get('sort_by') == 'team_name_desc' %}selected{% endif %}>Team Name (Z-A)</option>
            </select>
        </div>

        <!-- Submit and Reset Buttons -->
        <div class="form-group btn-block">
            <button type="submit" class="btn btn-primary btn-block">Filter</button>
            <button type="reset" class="btn btn-secondary btn-block">Reset</button>
        </div>
    </div>
</form>

<!-- Loading Spinner -->
<div id="loading-spinner" style="display: none; text-align: center;">
    <span>Loading...</span>
</div>



<!-- Search Form -->
<form method="get" action="/teams" class="search-form">
    <input
        type="text"
        name="search"
        value="{{ request.args.get('search', '') }}"
        class="form-control d-inline-block"
        style="width: 300px;"
        placeholder="Search by team name"
    />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Search</button>
</form>


{% if teams %}
    <h2>Search Results</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Year</th>
                <th>League</th>
                <th>Team</th>
                <th>Franchise</th>
                <th>Division</th>
                <th>Wins</th>
                <th>Losses</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for team in teams %}
            <tr>
                <td>{{ team.Year }}</td>
                <td>{{ team.League }}</td>
                <td>{{ team.Team }}</td>
                <td>{{ team.Franchise }}</td>
                <td>{{ team.TeamDivision }}</td>
                <td>{{ team.Wins }}</td>
                <td>{{ team.Losses }}</td>
                <td>
                    <form method="POST" action="/teams" style="display:inline;">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="team_id" value="{{ team.TeamID }}">
                        <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i> Delete</button>
                    </form>                                                                        
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% elif request.args.get('search') %}
    <p>No results found. Try searching for a different team name.</p>
{% endif %}

<!-- "Top Teams by League" Button -->
<div>
    <form method="get" action="/teams">
        <input type="hidden" name="action" value="view_top_teams_byLeague">
        <button type="submit" class="btn btn-primary">Top Teams by League</button>
    </form>
</div>

<!-- Top Teams Table (Only visible after button click) -->
{% if top_teams_league  %}
    <h2>Top Teams by League</h2>
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th>Year</th>
                <th>League ID</th>
                <th>League Name</th>
                <th>Team Name</th>
                <th>Wins</th>
            </tr>
        </thead>
        <tbody>
            {% for team in top_teams_league  %}
            <tr>
                <td>{{ team.Year }}</td>
                <td>{{ team.LeagueID }}</td>
                <td>{{ team.LeagueName }}</td>
                <td>{{ team.Team }}</td>
                <td>{{ team.Wins }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}

<!-- "Top Teams by League" Button -->
<div>
    <form method="get" action="/teams">
        <input type="hidden" name="action" value="view_top_teams_byYear">
        <button type="submit" class="btn btn-primary">Top Teams by Year</button>
    </form>
</div>

<!-- Top Teams Table (Only visible after button click) -->
{% if top_teams_year  %}
    <h2>Top Teams by Year</h2>
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th>Year</th>
                <th>League</th>
                <th>League Name</th>
                <th>Team Name</th>
                <th>Wins</th>
            </tr>
        </thead>
        <tbody>
            {% for team in top_teams_year %}
            <tr>
                <td>{{ team.Year }}</td>
                <td>{{ team.LeagueID }}</td>
                <td>{{ team.LeagueName }}</td>
                <td>{{ team.Team }}</td>
                <td>{{ team.Wins }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div>
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% endblock %}

